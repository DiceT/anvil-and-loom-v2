import { c as createLucideIcon, r as reactExports, j as jsxRuntimeExports, I as IconButton, D as Dices, u as useToolStore, T as TentTree, a as Infinity } from "./index-ChM8alZf.js";
import { d as rollDiceExpression, e as logResultCard, s as selectRandomOracleByTag, p as parseTableId, f as getParentId, h as getTableById, i as getOraclesByTag, a as useTableStore, j as useResultsStore, u as useWeaveStore, b as useTabStore, P as Plus, T as Trash2, c as rollWeave, l as logWeaveResult } from "./weaveResult-DLyoUq4r.js";
const __iconNode$d = [["path", { d: "m6 9 6 6 6-6", key: "qrunsl" }]];
const ChevronDown = createLucideIcon("chevron-down", __iconNode$d);
const __iconNode$c = [["path", { d: "m9 18 6-6-6-6", key: "mthhwq" }]];
const ChevronRight = createLucideIcon("chevron-right", __iconNode$c);
const __iconNode$b = [["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }]];
const Circle = createLucideIcon("circle", __iconNode$b);
const __iconNode$a = [
  [
    "path",
    {
      d: "M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",
      key: "1f1r0c"
    }
  ]
];
const Diamond = createLucideIcon("diamond", __iconNode$a);
const __iconNode$9 = [
  ["circle", { cx: "12", cy: "12", r: "1", key: "41hilf" }],
  ["circle", { cx: "12", cy: "5", r: "1", key: "gxeob9" }],
  ["circle", { cx: "12", cy: "19", r: "1", key: "lyex9k" }]
];
const EllipsisVertical = createLucideIcon("ellipsis-vertical", __iconNode$9);
const __iconNode$8 = [
  [
    "path",
    {
      d: "M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",
      key: "g5wo59"
    }
  ],
  ["path", { d: "m5.082 11.09 8.828 8.828", key: "1wx5vj" }]
];
const Eraser = createLucideIcon("eraser", __iconNode$8);
const __iconNode$7 = [
  [
    "path",
    {
      d: "M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",
      key: "yt0hxn"
    }
  ]
];
const Hexagon = createLucideIcon("hexagon", __iconNode$7);
const __iconNode$6 = [
  ["circle", { cx: "12", cy: "12", r: "10", key: "1mglay" }],
  ["path", { d: "M12 16v-4", key: "1dtifu" }],
  ["path", { d: "M12 8h.01", key: "e9boi3" }]
];
const Info = createLucideIcon("info", __iconNode$6);
const __iconNode$5 = [
  [
    "path",
    {
      d: "M10.83 2.38a2 2 0 0 1 2.34 0l8 5.74a2 2 0 0 1 .73 2.25l-3.04 9.26a2 2 0 0 1-1.9 1.37H7.04a2 2 0 0 1-1.9-1.37L2.1 10.37a2 2 0 0 1 .73-2.25z",
      key: "2hea0t"
    }
  ]
];
const Pentagon = createLucideIcon("pentagon", __iconNode$5);
const __iconNode$4 = [
  ["line", { x1: "19", x2: "5", y1: "5", y2: "19", key: "1x9vlm" }],
  ["circle", { cx: "6.5", cy: "6.5", r: "2.5", key: "4mh3h7" }],
  ["circle", { cx: "17.5", cy: "17.5", r: "2.5", key: "1mdrzq" }]
];
const Percent = createLucideIcon("percent", __iconNode$4);
const __iconNode$3 = [
  [
    "path",
    {
      d: "M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",
      key: "1s2grr"
    }
  ],
  ["path", { d: "M20 2v4", key: "1rf3ol" }],
  ["path", { d: "M22 4h-4", key: "gwowj6" }],
  ["circle", { cx: "4", cy: "20", r: "2", key: "6kqj1y" }]
];
const Sparkles = createLucideIcon("sparkles", __iconNode$3);
const __iconNode$2 = [
  ["path", { d: "M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7", key: "1m0v6g" }],
  [
    "path",
    {
      d: "M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",
      key: "ohrbg2"
    }
  ]
];
const SquarePen = createLucideIcon("square-pen", __iconNode$2);
const __iconNode$1 = [
  ["rect", { width: "18", height: "18", x: "3", y: "3", rx: "2", key: "afitv7" }]
];
const Square = createLucideIcon("square", __iconNode$1);
const __iconNode = [
  [
    "path",
    { d: "M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z", key: "14u9p9" }
  ]
];
const Triangle = createLucideIcon("triangle", __iconNode);
function DiceTool() {
  const [expression, setExpression] = reactExports.useState("");
  const [error, setError] = reactExports.useState(null);
  const [advantageMode, setAdvantageMode] = reactExports.useState("none");
  const handleDiceClick = (die) => {
    setExpression((prev) => {
      if (advantageMode !== "none") {
        const keepModifier = advantageMode === "advantage" ? "kh" : "kl";
        const prefix = prev.trim() && !prev.trim().endsWith("+") && !prev.trim().endsWith("-") ? "+" : "";
        const newExpression = prev + prefix + `2${die}${keepModifier}`;
        setAdvantageMode("none");
        return newExpression;
      }
      const diePattern = new RegExp(`(\\d*)${die.replace("d", "d")}`, "i");
      const match = prev.match(diePattern);
      if (match) {
        const currentCount = match[1] ? parseInt(match[1], 10) : 1;
        const newCount = currentCount + 1;
        return prev.replace(diePattern, `${newCount}${die}`);
      } else {
        const prefix = prev.trim() && !prev.trim().endsWith("+") && !prev.trim().endsWith("-") ? "+" : "";
        return prev + prefix + die;
      }
    });
    setError(null);
  };
  const handleModifierClick = (modifier) => {
    setExpression((prev) => prev + modifier);
    setError(null);
  };
  const handleRoll = async () => {
    if (!expression.trim()) {
      setError("Please enter a dice expression");
      return;
    }
    try {
      setError(null);
      const result = await rollDiceExpression(expression);
      const rollsText = result.rolls.map((r) => r.kept ? `**${r.value}**` : `${r.value}`).join(" + ");
      const modifierText = result.modifier ? ` ${result.modifier > 0 ? "+" : ""}${result.modifier}` : "";
      logResultCard({
        header: `DICE: ${expression}`,
        result: `${result.total}`,
        content: `Expression: ${expression}
Rolls: ${rollsText}${modifierText}`,
        source: "dice",
        meta: {
          expression: result.expression,
          rolls: result.rolls,
          modifier: result.modifier
        }
      });
    } catch (err) {
      setError(err instanceof Error ? err.message : "Failed to roll dice");
    }
  };
  const handleClear = () => {
    setExpression("");
    setError(null);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-3", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide", children: "Dice Tray" }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Triangle,
          size: "m",
          onClick: () => handleDiceClick("d4"),
          tooltip: "d4"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Square,
          size: "m",
          onClick: () => handleDiceClick("d6"),
          tooltip: "d6"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Diamond,
          size: "m",
          onClick: () => handleDiceClick("d8"),
          tooltip: "d8"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Circle,
          size: "m",
          onClick: () => handleDiceClick("d10"),
          tooltip: "d10"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Pentagon,
          size: "m",
          onClick: () => handleDiceClick("d12"),
          tooltip: "d12"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Hexagon,
          size: "m",
          onClick: () => handleDiceClick("d20"),
          tooltip: "d20"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Percent,
          size: "m",
          onClick: () => handleDiceClick("d100"),
          tooltip: "d100"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-center gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => handleModifierClick("-1"),
          className: "px-3 py-1 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs rounded transition-colors",
          children: "-1"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => setAdvantageMode(advantageMode === "disadvantage" ? "none" : "disadvantage"),
          className: `px-3 py-1 text-xs rounded transition-colors ${advantageMode === "disadvantage" ? "bg-blue-600 text-white" : "bg-slate-800 hover:bg-slate-700 text-slate-300"}`,
          "data-tooltip": "Disadvantage",
          children: "DIS"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => setAdvantageMode(advantageMode === "advantage" ? "none" : "advantage"),
          className: `px-3 py-1 text-xs rounded transition-colors ${advantageMode === "advantage" ? "bg-blue-600 text-white" : "bg-slate-800 hover:bg-slate-700 text-slate-300"}`,
          "data-tooltip": "Advantage",
          children: "ADV"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => handleModifierClick("+1"),
          className: "px-3 py-1 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs rounded transition-colors",
          children: "+1"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide", children: "Dice Expression" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "input",
      {
        type: "text",
        value: expression,
        onChange: (e) => {
          setExpression(e.target.value);
          setError(null);
        },
        placeholder: "e.g., 2d6+3, d20+5",
        className: "w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500",
        onKeyDown: (e) => {
          if (e.key === "Enter") {
            handleRoll();
          }
        }
      }
    ),
    error && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-red-400 px-2", children: error }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center pt-1", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Eraser,
          size: "m",
          onClick: handleClear,
          tooltip: "Clear expression"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Info,
          size: "m",
          tooltip: "kl         keep lowest\nkh         keep highest\nklN        keep lowest N\nkhN        keep highest N"
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Dices,
          size: "m",
          onClick: handleRoll,
          disabled: !expression.trim(),
          tooltip: "Roll dice"
        }
      )
    ] })
  ] });
}
const tools = [
  {
    id: "dice",
    name: "Dice",
    icon: Dices,
    component: DiceTool
  }
];
function ToolPanel() {
  const activeTool = useToolStore((state) => state.activeTool);
  if (!activeTool) {
    return null;
  }
  const tool = tools.find((t) => t.id === activeTool);
  if (!tool) {
    return null;
  }
  const ToolComponent = tool.component;
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-slate-850 border-y border-slate-800 px-3 py-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ToolComponent, {}) });
}
function rollD100() {
  return Math.floor(Math.random() * 100) + 1;
}
function resolveRoll(table, roll) {
  return table.tableData.find((row) => roll >= row.floor && roll <= row.ceiling) || null;
}
function isMacroResult(result) {
  const macros = ["ACTION + THEME", "DESCRIPTOR + FOCUS", "ROLL TWICE", "OBJECTIVES", "THE WEAVE"];
  return macros.includes(result.trim().toUpperCase());
}
function getMacroType(result) {
  const normalized = result.trim().toUpperCase();
  switch (normalized) {
    case "ACTION + THEME":
      return "ACTION_THEME";
    case "DESCRIPTOR + FOCUS":
      return "DESCRIPTOR_FOCUS";
    case "ROLL TWICE":
      return "ROLL_TWICE";
    case "OBJECTIVES":
      return "OBJECTIVES";
    case "THE WEAVE":
      return "THE_WEAVE";
    default:
      return null;
  }
}
function rollOnTable(table, explicitRoll) {
  const roll = explicitRoll !== void 0 ? explicitRoll : rollD100();
  const row = resolveRoll(table, roll);
  if (!row) {
    throw new Error(
      `Failed to resolve roll ${roll} on table ${table.id} (max: ${table.maxRoll})`
    );
  }
  const result = row.result;
  const isMacro = isMacroResult(result);
  const macroType = isMacro ? getMacroType(result) ?? void 0 : void 0;
  return {
    tableId: table.id,
    tableName: table.name,
    roll,
    result,
    isMacro,
    macroType
  };
}
function resolveActionTheme(registry) {
  const actionTable = selectRandomOracleByTag(registry, "action");
  const themeTable = selectRandomOracleByTag(registry, "theme");
  if (!actionTable || !themeTable) {
    console.error("Failed to find action or theme tables");
    return null;
  }
  const actionRoll = rollOnTable(actionTable);
  const themeRoll = rollOnTable(themeTable);
  return {
    type: "combo",
    rolls: [actionRoll, themeRoll],
    selectedTables: [actionTable.id, themeTable.id]
  };
}
function resolveDescriptorFocus(registry) {
  const descriptorTable = selectRandomOracleByTag(registry, "descriptor");
  const focusTable = selectRandomOracleByTag(registry, "focus");
  if (!descriptorTable || !focusTable) {
    console.error("Failed to find descriptor or focus tables");
    return null;
  }
  const descriptorRoll = rollOnTable(descriptorTable);
  const focusRoll = rollOnTable(focusTable);
  return {
    type: "combo",
    rolls: [descriptorRoll, focusRoll],
    selectedTables: [descriptorTable.id, focusTable.id]
  };
}
function resolveRollTwice(registry, sourceTableId, depth = 0) {
  if (depth > 5) {
    console.warn("ROLL TWICE recursion depth exceeded");
    return null;
  }
  const table = getTableById(registry, sourceTableId);
  if (!table) {
    console.error(`Table not found for ROLL TWICE: ${sourceTableId}`);
    return null;
  }
  const roll1 = rollOnTable(table);
  const roll2 = rollOnTable(table);
  const rolls = [];
  if (roll1.isMacro && roll1.macroType === "ROLL_TWICE") {
    const nested = resolveRollTwice(registry, sourceTableId, depth + 1);
    if (nested) {
      rolls.push(...nested.rolls);
    }
  } else {
    rolls.push(roll1);
  }
  if (roll2.isMacro && roll2.macroType === "ROLL_TWICE") {
    const nested = resolveRollTwice(registry, sourceTableId, depth + 1);
    if (nested) {
      rolls.push(...nested.rolls);
    }
  } else {
    rolls.push(roll2);
  }
  return {
    type: "repeat",
    rolls,
    sourceTableId
  };
}
function resolveObjectives(registry, sourceTableId) {
  try {
    const parts = parseTableId(sourceTableId);
    if (parts.type !== "aspect" && parts.type !== "domain") {
      console.error("OBJECTIVES macro can only be used in Aspect/Domain tables");
      return null;
    }
    const parentId = getParentId(sourceTableId);
    if (!parentId) {
      console.error("Failed to determine parent for OBJECTIVES");
      return null;
    }
    const objectivesTableId = `${parts.type}:${parentId}:objectives`;
    const objectivesTable = getTableById(registry, objectivesTableId);
    if (!objectivesTable) {
      console.error(`Objectives table not found: ${objectivesTableId}`);
      return null;
    }
    const roll = rollOnTable(objectivesTable);
    return {
      type: "reference",
      rolls: [roll],
      sourceTableId
    };
  } catch (error) {
    console.error("Error resolving OBJECTIVES:", error);
    return null;
  }
}
function resolveTheWeave() {
  return {
    type: "placeholder",
    rolls: [],
    message: "THE WEAVE (not yet implemented)"
  };
}
function resolveMacro(registry, rollResult, sourceTableId) {
  if (!rollResult.isMacro || !rollResult.macroType) {
    return null;
  }
  switch (rollResult.macroType) {
    case "ACTION_THEME":
      return resolveActionTheme(registry);
    case "DESCRIPTOR_FOCUS":
      return resolveDescriptorFocus(registry);
    case "ROLL_TWICE":
      if (!sourceTableId) {
        console.error("ROLL TWICE requires sourceTableId");
        return null;
      }
      return resolveRollTwice(registry, sourceTableId);
    case "OBJECTIVES":
      if (!sourceTableId) {
        console.error("OBJECTIVES requires sourceTableId");
        return null;
      }
      return resolveObjectives(registry, sourceTableId);
    case "THE_WEAVE":
      return resolveTheWeave();
    default:
      console.warn(`Unknown macro type: ${rollResult.macroType}`);
      return null;
  }
}
function formatTableRollCard(roll, category, parentName, packId) {
  const header = parentName ? `${category}: ${parentName}: ${roll.tableName}`.toUpperCase() : `${category}: ${roll.tableName}`.toUpperCase();
  const content = `Roll: ${roll.roll}
Result: ${roll.result}`;
  let source = "table";
  if (category.toUpperCase() === "ASPECT") source = "aspect";
  else if (category.toUpperCase() === "DOMAIN") source = "domain";
  else if (category.toUpperCase() === "ORACLE") source = "oracle";
  logResultCard({
    header,
    result: roll.result,
    content,
    source,
    meta: {
      tableId: roll.tableId,
      roll: roll.roll,
      packId,
      packName: parentName
    }
  });
}
function formatComboOracleCard(macroResult, oracleLabel, registry) {
  if (macroResult.type !== "combo" || macroResult.rolls.length !== 2) {
    console.error("Invalid combo oracle result");
    return;
  }
  const [roll1, roll2] = macroResult.rolls;
  const header = oracleLabel.toUpperCase();
  const result = `${roll1.result} + ${roll2.result}`;
  const tag1 = oracleLabel.split(" + ")[0].toLowerCase();
  const tag2 = oracleLabel.split(" + ")[1].toLowerCase();
  const tablesWithTag1 = getOraclesByTag(registry, tag1);
  const tablesWithTag2 = getOraclesByTag(registry, tag2);
  const contentLines = [
    `${roll1.tableName} (${roll1.roll}): ${roll1.result}`
  ];
  if (tablesWithTag1.length > 1) {
    contentLines.push(`  Selected ${roll1.tableName} from ${tablesWithTag1.length} tables with '${tag1}' tag`);
  }
  contentLines.push("");
  contentLines.push(`${roll2.tableName} (${roll2.roll}): ${roll2.result}`);
  if (tablesWithTag2.length > 1) {
    contentLines.push(`  Selected ${roll2.tableName} from ${tablesWithTag2.length} tables with '${tag2}' tag`);
  }
  contentLines.push("");
  contentLines.push(`Prompt: "${roll1.result} ${roll2.result}"`);
  const content = contentLines.join("\n");
  logResultCard({
    header,
    result,
    content,
    source: "oracle",
    meta: {
      oracleType: oracleLabel,
      rolls: macroResult.rolls,
      selectedTables: macroResult.selectedTables
    }
  });
}
function formatRollTwiceCard(macroResult, tableName) {
  if (macroResult.type !== "repeat") {
    console.error("Invalid ROLL TWICE result");
    return;
  }
  const header = `TABLE: ${tableName} (ROLL TWICE)`.toUpperCase();
  const results = macroResult.rolls.map((r) => r.result);
  const result = results.join("\n");
  const content = macroResult.rolls.map((roll, index) => `Roll ${index + 1} (${roll.roll}): ${roll.result}`).join("\n");
  logResultCard({
    header,
    result,
    content,
    source: "table",
    meta: {
      sourceTableId: macroResult.sourceTableId,
      rolls: macroResult.rolls
    }
  });
}
function formatObjectivesCard(macroResult, sourceTableName) {
  if (macroResult.type !== "reference" || macroResult.rolls.length === 0) {
    console.error("Invalid OBJECTIVES result");
    return;
  }
  const roll = macroResult.rolls[0];
  const header = `TABLE: ${sourceTableName} â†’ OBJECTIVES`.toUpperCase();
  const result = roll.result;
  const content = `Triggered by: ${sourceTableName}
Objectives Roll (${roll.roll}): ${roll.result}`;
  logResultCard({
    header,
    result,
    content,
    source: "table",
    meta: {
      sourceTableId: macroResult.sourceTableId,
      objectivesTableId: roll.tableId,
      roll: roll.roll
    }
  });
}
function formatTheWeaveCard() {
  logResultCard({
    header: "THE WEAVE",
    result: "Not yet implemented",
    content: "THE WEAVE macro was rolled, but this feature is not yet implemented.",
    source: "system",
    meta: {
      macroType: "THE_WEAVE"
    }
  });
}
const sourceColors = {
  dice: "#222244",
  aspect: "#224433",
  // Green-ish for Aspects
  domain: "#224433",
  // Green-ish for Domains
  table: "#224422",
  // General table (legacy)
  oracle: "#332244",
  // Purple-ish for Oracles
  interpretation: "#442244",
  weave: "#685431",
  // The Weave's gold/brown
  system: "#1e293b",
  other: "#1e293b"
};
function ResultCard({ card, defaultExpanded = false }) {
  const [isExpanded, setIsExpanded] = reactExports.useState(defaultExpanded);
  const { registry } = useTableStore();
  const { setRightPaneMode, setRequestExpandPack } = useToolStore();
  const headerBgColor = sourceColors[card.source || "other"];
  const timestamp = new Date(card.timestamp).toLocaleTimeString();
  const handleRollOracle = (type) => {
    if (!registry) return;
    if (type === "action" || type === "theme") {
      const result = resolveActionTheme(registry);
      if (result) {
        formatComboOracleCard(result, "Action + Theme", registry);
      }
    } else {
      const result = resolveDescriptorFocus(registry);
      if (result) {
        formatComboOracleCard(result, "Descriptor + Focus", registry);
      }
    }
  };
  const handleOpenEnvironment = (packId2) => {
    setRightPaneMode("environments");
    setRequestExpandPack(packId2);
  };
  const handleWeaveAction = (targetType, targetId) => {
    if (targetType === "aspect" || targetType === "domain") {
      handleOpenEnvironment(targetId);
    } else if (targetType === "oracleCombo") {
      if (targetId === "Action+Theme") {
        handleRollOracle("action");
      } else if (targetId === "Descriptor+Focus") {
        handleRollOracle("descriptor");
      }
    }
  };
  const isOracleCombo = card.source === "oracle" && card.meta?.oracleType;
  card.meta?.oracleType;
  const isAspectOrDomain = (card.source === "aspect" || card.source === "domain") && card.meta?.packId;
  const packId = card.meta?.packId;
  const isWeave = card.source === "weave" && card.meta?.targetType;
  const weaveTargetType = card.meta?.targetType;
  const weaveTargetId = card.meta?.targetId;
  const renderResultWithButtons = () => {
    if (isWeave) {
      const icon = weaveTargetType === "aspect" || weaveTargetType === "domain" ? TentTree : Sparkles;
      const IconComponent = icon;
      const tooltipText = weaveTargetType === "aspect" || weaveTargetType === "domain" ? "Open in Environments" : "Roll Oracle";
      return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-bold text-slate-100 text-base flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: card.result }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: () => handleWeaveAction(weaveTargetType, weaveTargetId),
            className: "p-1 hover:bg-slate-700 rounded transition-colors",
            title: tooltipText,
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(IconComponent, { className: "w-4 h-4 text-slate-400" })
          }
        )
      ] });
    }
    if (isAspectOrDomain) {
      return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "font-bold text-slate-100 text-base flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: card.result }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: () => handleOpenEnvironment(packId),
            className: "p-1 hover:bg-slate-700 rounded transition-colors",
            title: "Open in Environments",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(TentTree, { className: "w-4 h-4 text-slate-400" })
          }
        )
      ] });
    }
    if (isOracleCombo) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "font-bold text-slate-100 text-base", children: card.result });
    }
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: `font-bold text-slate-100 ${card.source === "dice" ? "text-2xl" : "text-base"}`, children: card.result });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-slate-800 border border-slate-700 rounded-lg overflow-hidden flex flex-col", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "button",
      {
        onClick: () => setIsExpanded(!isExpanded),
        className: "px-3 py-2 border-b border-slate-700 text-left transition-opacity hover:opacity-90 focus:outline-none",
        style: { backgroundColor: headerBgColor },
        children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("h4", { className: "text-sm font-semibold", style: { color: "#eeffff" }, children: card.header }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: "text-xs",
              style: { color: "#eeffff", opacity: 0.7 },
              children: timestamp
            }
          )
        ] })
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "overflow-hidden transition-all duration-300 ease-in-out",
        style: {
          maxHeight: isExpanded ? "500px" : "0px",
          opacity: isExpanded ? 1 : 0
        },
        children: /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "px-3 py-3 text-sm text-slate-400 whitespace-pre-wrap",
            dangerouslySetInnerHTML: {
              __html: card.content.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
            }
          }
        )
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-3 py-3 border-t border-slate-700", children: renderResultWithButtons() })
  ] });
}
function ResultsFullPane() {
  const cards = useResultsStore((state) => state.cards);
  const scrollRef = reactExports.useRef(null);
  const allResultsCards = cards.slice(0, -1);
  reactExports.useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [allResultsCards.length]);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-2 pt-2 pb-2 h-full flex flex-col", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide mb-3", children: "All Results" }),
    allResultsCards.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-sm text-slate-500", children: "No results yet" }) }) : /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref: scrollRef, className: "flex-1 overflow-y-auto app-scroll", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "space-y-2", children: allResultsCards.map((card) => /* @__PURE__ */ jsxRuntimeExports.jsx(ResultCard, { card, defaultExpanded: false }, card.id)) }) })
  ] });
}
function EnvironmentsPane() {
  const { registry, loadTables } = useTableStore();
  const { requestExpandPack, setRequestExpandPack } = useToolStore();
  const [expandedPacks, setExpandedPacks] = reactExports.useState(/* @__PURE__ */ new Set());
  reactExports.useEffect(() => {
    if (!registry) {
      loadTables();
    }
  }, [registry, loadTables]);
  reactExports.useEffect(() => {
    if (requestExpandPack) {
      setExpandedPacks((prev) => {
        const next = new Set(prev);
        next.add(requestExpandPack);
        return next;
      });
      setRequestExpandPack(null);
    }
  }, [requestExpandPack, setRequestExpandPack]);
  if (!registry) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-slate-500", children: "Loading tables..." }) });
  }
  const aspects = Array.from(registry.aspectPacks.values()).sort(
    (a, b) => a.packName.localeCompare(b.packName)
  );
  const domains = Array.from(registry.domainPacks.values()).sort(
    (a, b) => a.packName.localeCompare(b.packName)
  );
  const togglePack = (packId) => {
    setExpandedPacks((prev) => {
      const next = new Set(prev);
      if (next.has(packId)) {
        next.delete(packId);
      } else {
        next.add(packId);
      }
      return next;
    });
  };
  const handleAddToWeave = (type, packId) => {
    const { useWeaveStore: useWeaveStore2 } = require("../../stores/useWeaveStore");
    const { useTabStore: useTabStore2 } = require("../../stores/useTabStore");
    const { generateRowId, recalculateRanges } = require("../../core/weave/weaveUtils");
    const { registry: weaveRegistry, activeWeaveId, createWeave, updateWeave, setActiveWeave } = useWeaveStore2.getState();
    const { openTab } = useTabStore2.getState();
    let weave = activeWeaveId ? weaveRegistry?.weaves.get(activeWeaveId) ?? null : null;
    if (!weave) {
      weave = createWeave({ name: `${packId} Weave`, author: "T" });
    }
    const newRow = {
      id: generateRowId(),
      from: 0,
      to: 0,
      targetType: type,
      targetId: packId
    };
    const updatedRows = recalculateRanges([...weave.rows, newRow], weave.maxRoll);
    const updatedWeave = { ...weave, rows: updatedRows };
    updateWeave(updatedWeave);
    setActiveWeave(updatedWeave.id);
    openTab({
      id: updatedWeave.id,
      type: "weave",
      title: updatedWeave.name
    });
  };
  const handleRollSubtable = (pack, subtableIndex) => {
    const table = pack.tables[subtableIndex];
    const result = rollOnTable(table);
    if (result.isMacro) {
      const macroResult = resolveMacro(registry, result, table.id);
      if (macroResult) {
        switch (macroResult.type) {
          case "combo":
            const oracleLabel = result.macroType === "ACTION_THEME" ? "Action + Theme" : "Descriptor + Focus";
            formatComboOracleCard(macroResult, oracleLabel, registry);
            break;
          case "repeat":
            formatRollTwiceCard(macroResult, table.name);
            break;
          case "reference":
            formatObjectivesCard(macroResult, table.name);
            break;
          case "placeholder":
            formatTheWeaveCard();
            break;
        }
      }
    } else {
      const category = pack.category === "aspect" ? "ASPECT" : "DOMAIN";
      formatTableRollCard(result, category, pack.packName, pack.packId);
    }
  };
  const renderPack = (pack) => {
    const isExpanded = expandedPacks.has(pack.packId);
    const subtableNames = pack.category === "aspect" ? ["Objectives", "Atmosphere", "Manifestations", "Discoveries", "Banes", "Boons"] : ["Objectives", "Atmosphere", "Locations", "Discoveries", "Banes", "Boons"];
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-b border-slate-700 last:border-0", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between py-2 px-3 hover:bg-slate-800 transition-colors", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "button",
          {
            onClick: () => togglePack(pack.packId),
            className: "flex items-center gap-2 flex-1 text-left",
            children: [
              isExpanded ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4 text-slate-400" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "w-4 h-4 text-slate-400" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-slate-300", children: pack.packName })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: () => handleAddToWeave(pack.category, pack.packId),
            className: "p-1 hover:bg-slate-700 rounded transition-colors",
            "data-tooltip": "Add to Weave",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Infinity, { className: "w-4 h-4 text-slate-500" })
          }
        )
      ] }),
      isExpanded && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "pl-6 pr-3 pb-2", children: pack.tables.map((table, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "div",
        {
          className: "flex items-center justify-between py-1.5 hover:bg-slate-800 px-2 rounded transition-colors",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-slate-400", children: subtableNames[index] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => handleRollSubtable(pack, index),
                className: "p-1 hover:bg-slate-700 rounded transition-colors",
                "data-tooltip": `Roll on ${subtableNames[index]}`,
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Dices, { className: "w-4 h-4 text-slate-500" })
              }
            )
          ]
        },
        table.id
      )) })
    ] }, pack.packId);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-2 pt-2 pb-2 h-full overflow-y-auto app-scroll", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2 px-3", children: "Aspects" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-slate-800 rounded-lg overflow-hidden", children: aspects.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 text-sm text-slate-500 text-center", children: "No aspects found" }) : aspects.map(renderPack) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2 px-3", children: "Domains" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-slate-800 rounded-lg overflow-hidden", children: domains.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 text-sm text-slate-500 text-center", children: "No domains found" }) : domains.map(renderPack) })
    ] })
  ] });
}
function OraclesPane() {
  const { registry, loadTables } = useTableStore();
  const [expandedSections, setExpandedSections] = reactExports.useState(/* @__PURE__ */ new Set(["core"]));
  reactExports.useEffect(() => {
    if (!registry) {
      loadTables();
    }
  }, [registry, loadTables]);
  if (!registry) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-slate-500", children: "Loading oracles..." }) });
  }
  const handleComboOracle = (type) => {
    if (type === "action-theme") {
      const result = resolveActionTheme(registry);
      if (result) {
        formatComboOracleCard(result, "Action + Theme", registry);
      }
    } else {
      const result = resolveDescriptorFocus(registry);
      if (result) {
        formatComboOracleCard(result, "Descriptor + Focus", registry);
      }
    }
  };
  const handleRollOracle = (oracle) => {
    const result = rollOnTable(oracle.table);
    formatTableRollCard(result, "ORACLE");
  };
  const toggleSection = (section) => {
    setExpandedSections((prev) => {
      const next = new Set(prev);
      if (next.has(section)) {
        next.delete(section);
      } else {
        next.add(section);
      }
      return next;
    });
  };
  const coreOracles = Array.from(registry.oracles.values()).filter((o) => o.source === "core").sort((a, b) => a.table.name.localeCompare(b.table.name));
  const userOracles = Array.from(registry.oracles.values()).filter((o) => o.source === "user").sort((a, b) => a.table.name.localeCompare(b.table.name));
  const renderOracleList = (oracles) => {
    if (oracles.length === 0) {
      return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 text-sm text-slate-500 text-center", children: "No oracles found" });
    }
    return oracles.map((oracle) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between py-2 px-3 hover:bg-slate-800 transition-colors",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-slate-300", children: oracle.table.name }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "button",
            {
              onClick: () => handleRollOracle(oracle),
              className: "p-1 hover:bg-slate-700 rounded transition-colors",
              "data-tooltip": `Roll on ${oracle.table.name}`,
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Dices, { className: "w-4 h-4 text-slate-500" })
            }
          )
        ]
      },
      oracle.table.id
    ));
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-2 pt-2 pb-2 h-full overflow-y-auto app-scroll", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4 px-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2", children: "Combo Oracles" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "button",
          {
            onClick: () => handleComboOracle("action-theme"),
            className: "flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded transition-colors text-white",
            style: { backgroundColor: "#332244" },
            onMouseEnter: (e) => e.currentTarget.style.backgroundColor = "#442255",
            onMouseLeave: (e) => e.currentTarget.style.backgroundColor = "#332244",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Dices, { className: "w-4 h-4" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Action + Theme" })
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "button",
          {
            onClick: () => handleComboOracle("descriptor-focus"),
            className: "flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded transition-colors text-white",
            style: { backgroundColor: "#332244" },
            onMouseEnter: (e) => e.currentTarget.style.backgroundColor = "#442255",
            onMouseLeave: (e) => e.currentTarget.style.backgroundColor = "#332244",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(Dices, { className: "w-4 h-4" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium", children: "Descriptor + Focus" })
            ]
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: () => toggleSection("core"),
          className: "flex items-center gap-2 w-full text-left px-3 py-2 hover:bg-slate-800 transition-colors",
          children: [
            expandedSections.has("core") ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4 text-slate-400" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "w-4 h-4 text-slate-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide", children: "Core Oracles" })
          ]
        }
      ),
      expandedSections.has("core") && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-slate-800 rounded-lg overflow-hidden mt-2", children: renderOracleList(coreOracles) })
    ] }),
    userOracles.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mb-4", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: () => toggleSection("user"),
          className: "flex items-center gap-2 w-full text-left px-3 py-2 hover:bg-slate-800 transition-colors",
          children: [
            expandedSections.has("user") ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4 text-slate-400" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "w-4 h-4 text-slate-400" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide", children: "User Oracles" })
          ]
        }
      ),
      expandedSections.has("user") && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-slate-800 rounded-lg overflow-hidden mt-2", children: renderOracleList(userOracles) })
    ] })
  ] });
}
function WeaveTool() {
  const { registry, loadWeaves, createWeave, deleteWeave } = useWeaveStore();
  const openTab = useTabStore((state) => state.openTab);
  const [contextMenuTarget, setContextMenuTarget] = reactExports.useState(null);
  reactExports.useEffect(() => {
    if (!registry) {
      loadWeaves();
    }
  }, [registry, loadWeaves]);
  const weaves = Array.from(registry?.weaves.values() ?? []).sort(
    (a, b) => a.name.localeCompare(b.name)
  );
  const handleRollWeave = (weave) => {
    try {
      const { roll, row } = rollWeave(weave);
      logWeaveResult(weave, roll, row);
    } catch (error) {
      console.error("Failed to roll weave:", error);
    }
  };
  const handleNewWeave = () => {
    const newWeave = createWeave({ name: "New Weave", author: "T" });
    openTab({
      id: newWeave.id,
      type: "weave",
      title: newWeave.name
    });
  };
  const handleOpenWeave = (weaveId) => {
    const weave = registry?.weaves.get(weaveId);
    if (weave) {
      openTab({
        id: weave.id,
        type: "weave",
        title: weave.name
      });
    }
  };
  const handleDeleteWeave = async (weaveId) => {
    if (confirm("Are you sure you want to delete this Weave?")) {
      try {
        await deleteWeave(weaveId);
      } catch (error) {
        console.error("Failed to delete weave:", error);
        alert("Failed to delete weave");
      }
    }
    setContextMenuTarget(null);
  };
  if (!registry) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 flex items-center justify-center p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-slate-500", children: "Loading weaves..." }) });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "px-2 pt-2 pb-2 h-full overflow-y-auto app-scroll", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center mb-3 px-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide", children: "The Weave" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleNewWeave,
          className: "flex items-center gap-1 px-2 py-1 bg-slate-700 hover:bg-slate-600 rounded transition-colors",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Plus, { className: "w-3 h-3 text-slate-300" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-slate-300", children: "New" })
          ]
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "bg-slate-800 rounded-lg overflow-hidden", children: weaves.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 text-sm text-slate-500 text-center", children: "No weaves found. Create one to get started!" }) : weaves.map((weave) => /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between py-2 px-3 hover:bg-slate-700 transition-colors border-b border-slate-700 last:border-0",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 flex-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-slate-300", children: weave.name }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-slate-500 px-1.5 py-0.5 bg-slate-900 rounded", children: [
              "d",
              weave.maxRoll
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: () => handleRollWeave(weave),
                className: "p-1 hover:bg-slate-600 rounded transition-colors",
                "data-tooltip": `Roll ${weave.name}`,
                children: /* @__PURE__ */ jsxRuntimeExports.jsx(Dices, { className: "w-4 h-4 text-slate-400" })
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: () => setContextMenuTarget(contextMenuTarget === weave.id ? null : weave.id),
                  className: "p-1 hover:bg-slate-600 rounded transition-colors",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(EllipsisVertical, { className: "w-4 h-4 text-slate-400" })
                }
              ),
              contextMenuTarget === weave.id && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "absolute right-0 top-8 bg-slate-800 border border-slate-700 rounded shadow-lg z-10 min-w-[120px]", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "button",
                  {
                    onClick: () => {
                      handleOpenWeave(weave.id);
                      setContextMenuTarget(null);
                    },
                    className: "w-full flex items-center gap-2 px-3 py-2 hover:bg-slate-700 transition-colors text-left",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(SquarePen, { className: "w-3 h-3 text-slate-400" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-slate-300", children: "Edit" })
                    ]
                  }
                ),
                /* @__PURE__ */ jsxRuntimeExports.jsxs(
                  "button",
                  {
                    onClick: () => handleDeleteWeave(weave.id),
                    className: "w-full flex items-center gap-2 px-3 py-2 hover:bg-slate-700 transition-colors text-left",
                    children: [
                      /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "w-3 h-3 text-red-400" }),
                      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-red-400", children: "Delete" })
                    ]
                  }
                )
              ] })
            ] })
          ] })
        ]
      },
      weave.id
    )) })
  ] });
}
function GlobalLastResult() {
  const cards = useResultsStore((state) => state.cards);
  const clearCards = useResultsStore((state) => state.clearCards);
  const lastCard = cards[cards.length - 1];
  if (!lastCard) {
    return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-slate-900 px-2 py-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-between items-center mb-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide", children: "Last Result" }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "text-xs text-slate-600 text-center py-4", children: "No results yet" })
    ] });
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-slate-900 px-2 pt-2 pb-2 flex flex-col", style: { maxHeight: "300px" }, children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex justify-between items-center mb-2 flex-shrink-0", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("h3", { className: "text-xs font-semibold text-slate-400 uppercase tracking-wide", children: "Last Result" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        IconButton,
        {
          icon: Eraser,
          size: "s",
          onClick: clearCards,
          tooltip: "Clear all results"
        }
      )
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 overflow-y-auto app-scroll min-h-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(ResultCard, { card: lastCard, defaultExpanded: true }) })
  ] });
}
function RightLane() {
  const { rightPaneMode } = useToolStore();
  const renderContent = () => {
    switch (rightPaneMode) {
      case "dice":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(ToolPanel, {});
      case "environments":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(EnvironmentsPane, {});
      case "oracles":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(OraclesPane, {});
      case "results":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(ResultsFullPane, {});
      case "weave":
        return /* @__PURE__ */ jsxRuntimeExports.jsx(WeaveTool, {});
      default:
        return null;
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "bg-slate-900 border-l border-slate-800 h-full flex flex-col", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 min-h-0 overflow-y-auto app-scroll", children: renderContent() }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0 border-t border-slate-800", children: /* @__PURE__ */ jsxRuntimeExports.jsx(GlobalLastResult, {}) })
  ] });
}
export {
  RightLane
};
